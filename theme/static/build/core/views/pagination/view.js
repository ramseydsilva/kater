define(["backbone","handlebars","underscore","text!./template.html"],function(e,t,a,i){var s=e.View.extend({currentPage:1,appendAction:"append",template:t.compile(i),pageLength:20,noDataMessage:"No results for this query.",noSearchResultMessage:"No matching results for your search.",onAdd:function(){},onRemove:function(){},events:{"click .pagination a":"navigateToPage"},initialize:function(e){this.columns={},this.pages=[],this.actions={},this.items=[],e&&e.el&&delete e.el,e&&e.pages&&delete e.pages,e&&e.items&&delete e.items,a.extend(this,e),this.render()},showNoData:function(e){e||(e="no-data"),this.$("tbody."+e).removeClass("hidden")},hideNoData:function(e){e||(e="no-data"),this.$("tbody."+e).addClass("hidden")},enableDisablePreviousNext:function(e){1==e?this.$(".pagination .previous").addClass("disabled").find("a").attr("page",""):this.pages.length>1&&this.$(".pagination .previous").removeClass("disabled").find("a").attr("page",e-1),e<this.pages.length?this.$(".pagination .next").removeClass("disabled").find("a").attr("page",e+1):this.$(".pagination .next").addClass("disabled").find("a").attr("page","")},navigateToPage:function(e){var t="number"==typeof e?e:parseInt(this.$(e.currentTarget).attr("page"));t&&(this.$("tbody.data tr").hide(),this.$("tbody.data tr").slice((t-1)*this.pageLength,t*this.pageLength).show(),this.$(".pagination .active").removeClass("active"),this.$('.pagination .paginate_page a[page="'+t+'"]').parent().addClass("active"),this.enableDisablePreviousNext(t),this.currentPage=t)},adjustPages:function(e,t,i){var s=Math.ceil((t.indexOf(e)+1)/this.pageLength);if(s!=this.currentPage?e.$el.hide():e.$el.show(),this.enableDisablePreviousNext(this.currentPage),s>0&&-1==this.pages.indexOf(s)){var n="";s==this.currentPage&&(n="active"),this.pages.push(s),this.$(".pagination .next").before('<li class="paginate_button paginate_page '+n+'"><a page="'+s+'">'+s+"</a></li>")}var o=Math.ceil(t.length/this.pageLength);if(this.pages.length&&a.last(this.pages)>o){var h=this.pages.pop(this.pages.length-1);this.currentPage>1&&this.currentPage==h&&(this.currentPage-=1),this.$('.pagination .paginate_page a[page="'+h+'"]').remove()}0==t.length?this.showNoData(i):this.hideNoData(i),this.renderPagination()},renderPagination:function(){return this.pages.length<=1?(this.$(".pagination").hide(),!1):(this.$(".pagination").show(),!0)},addToDom:function(e){this.$("tbody.data")[this.appendAction](e.el),this.onAdd(e),this.adjustPages(e,this.items),e.undelegatedEvents&&e.delegateEvents()},removeFromDom:function(e){e.remove(),this.onRemove(e),this.adjustPages(e,this.items),e.undelegatedEvents=!0},addOrRemoveFromDom:function(e){-1==this.items.indexOf(e)?this.removeFromDom(e):this.addToDom(e)},remove:function(t){t?(this.items.splice(this.items.indexOf(t),1),this.removeFromDom(t)):e.View.prototype.remove.call(this)},setSearchText:function(e){e.searchText=e.$el.text().toLowerCase()},add:function(e){e.searchText||this.setSearchText(e),this.items.push(e),this.addToDom(e)},search:function(e){var t=this,a=this.items.filter(function(t){return-1!=t.searchText.indexOf(e.toLowerCase())});this.items.forEach(function(e){t.adjustPages(e,a,"no-search-data")})},render:function(){return this.$el.html(this.template({colspan:a.keys(this.columns).length,columns:this.columns,actions:this.actions,noDataMessage:this.noDataMessage,noSearchResultMessage:this.noSearchResultMessage})),this.renderPagination(),this}});return s});