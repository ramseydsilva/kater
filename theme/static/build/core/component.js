define(["backbone","underscore","./router"],function(e,t){void 0===jQuery.when.all&&(jQuery.when.all=function(e){var t=new jQuery.Deferred;return $.when.apply(jQuery,e).then(function(){t.resolve(Array.prototype.slice.call(arguments))},function(){t.fail(Array.prototype.slice.call(arguments))}),t});var n=function(e,t,n){this.promise=$.Deferred(),this.name=e,this.loadedView=!1,this.router=n,this.route=t.route,this.depends=t.depends||[],this.shown=!1,t.el?this.el=t.el:(this.el=document.createElement("section"),this.el.id=this.name),this.$el=$(this.el),void 0!==t.route&&this.router&&this.registerRoute(t.route)};return n.prototype._loadView=function(){var e=this;require(["views/"+this.name],function(t){e.view=new t({name:e.name,el:e.$el,arguments:e.arguments}),e.view.name=e.name,e.loadedView=!0,e.promise.resolve(),e.show()})},n.prototype.loadView=function(){var e=this;if(e.arguments=arguments,this.loadedView)e.depends.forEach(function(e){app.components[e].show()}),e.show();else{var n=[];this.depends.forEach(function(e){app.components[e].loadView(),n.push(app.components[e].promise)}),$.when.all(n).then(t.bind(this._loadView,this))}if(null!==this.route&&void 0!==this.route){var o=t.where(app.components,{shown:!0});o.forEach(function(t){t!=e&&-1==e.depends.indexOf(t.name)&&t.hide()})}},n.prototype.registerRoute=function(e){this.router.route(e,this.name,t.bind(this.loadView,this))},n.prototype.show=function(){var e=this;this.promise.done(function(){e.shown=!0,e.view.show(e.arguments)})},n.prototype.hide=function(){var e=this;this.promise.done(function(){e.shown=!1,e.view.hide(e.arguments)})},n});