define(["core/view","underscore","text!templates/checkout.html","./checkout-item"],function(t,e,a,i){return t.extend({template:e.template(a),events:{'click input[name="payments"]':"selectPayment","click .showLoginModal":"showLoginModal"},initialize:function(){this.model=app.cart,this.render(),app.cart.items.on("add",this.addToCart,this),app.cart.on("change:sub_total",this.changeTotal,this),app.cart.on("change:special_request",this.changeSpecialRequest,this)},showLoginModal:function(t){t.preventDefault(),app.components["user-nav"].view.showLoginModal()},selectPayment:function(t){var e=$(t.currentTarget);"creditcard"==e.attr("value")&&$("#selectpayment").show(),"cashcard"==e.attr("value")&&$("#selectpayment").hide()},addToCart:function(t){t.checkout_view||(t.checkout_view=new i({model:t})),this.listItem.append(t.checkout_view.$el)},changeTotal:function(){this.sub_total.text(app.cart.get("sub_total")+"KD"),this.discount.text(app.cart.get("discount")+"KD"),this.grand_total.text(app.cart.get("grand_total")+"KD")},changeSpecialRequest:function(){this.special_request.text(app.cart.attributes.special_request)},show:function(){app.cart.items.length?this.$el.show():app.router.navigate("/my-cart",{trigger:!0})},render:function(){var t=this;this.html=$(this.template({model:this.model,loggedIn:app.user.attributes.username})),this.$el.html(this.html),this.listItem=this.$("#checkout-items"),this.model.items.each(function(e){t.addToCart(e)}),this.sub_total=this.$(".sub_total"),this.special_request=this.$(".special-request"),this.discount=this.$(".discount"),this.grand_total=this.$(".grand_total"),this.promise.resolve()}})});