define(["core/view","underscore","text!templates/caterer.html","./item-category","./review"],function(e,t,i,s,r){return e.extend({template:t.template(i),events:{"submit .reviewForm":"submitReview","mouseover .editable.ratingStars i":"mouseOverStars","mouseout .editable.ratingStars i":"mouseOutStars","click .editable.ratingStars i":"clickStars"},initialize:function(e){var t=this;this.slug=e.arguments[0],this.model=this.getModel(),this.model?this.render():app.collections.caterer.fetch({data:{slug:t.slug},success:function(){t.model=t.getModel(),t.model&&t.render()}})},show:function(e){var t=e[0];t!=this.slug&&(this.slug=t,this.model=this.getModel(),this.render()),this.$el.show()},clickStars:function(e){var t=$(e.target);t.parent().children().removeClass("selected").removeClass("selected-temp"),t.parent().children().each(function(e,i){parseInt(i.attributes.value.value)<=t.attr("value")&&i.classList.add("selected")}),this.reviewForm.rating[t.attr("item")]=t.attr("value")},mouseOverStars:function(e){var t=$(e.target),i=t.parent().find("i");i.removeClass("red"),t.parent().find(".selected").addClass("selected-temp").removeClass("selected"),t.parent().children().each(function(e,i){parseInt(i.attributes.value.value)<=t.attr("value")&&i.classList.add("red")})},mouseOutStars:function(e){var t=$(e.target),i=t.parent().find("i");i.removeClass("red"),t.parent().find(".selected-temp").addClass("selected")},getModel:function(){return app.collections.caterer.findWhere({slug:this.slug})},addItemCategory:function(e){e.view||(e.view=new s({model:e})),this.menu.append(e.view.$el)},submitReview:function(e){var t=this;return e.preventDefault(),this.model.reviews.create({first_name:this.reviewForm.first_name.val(),last_name:this.reviewForm.last_name.val(),email:this.reviewForm.email.val(),mobile_number:this.reviewForm.mobile_number.val(),title:this.reviewForm.title.val(),description:this.reviewForm.description.val(),caterer:this.model.id,rating:[{food:this.reviewForm.rating.food,service:this.reviewForm.rating.service,ambience:this.reviewForm.rating.ambience,value:this.reviewForm.rating.value}]},{wait:!0,error:function(){t.formError.html("<strong>Error:</strong> All fields are required.").removeClass("hidden")},success:function(){t.postRvwForm.html("<p>Thank you for your feedback. Your review has been posted.</p>")}}),!1},addReview:function(e){e.view||(e.view=new r({model:e})),this.reviewList.append(e.view.$el)},render:function(){var e=this;this.html=$(this.template({model:this.model})),this.$el.html(this.html),this.menu=this.$(".myMenu .menudtL"),this.reviewList=this.$(".reviewList"),this.formError=this.$(".formError"),this.postRvwForm=this.$(".postRvwForm"),this.reviewForm={first_name:this.$("input[name='first_name']"),last_name:this.$("input[name='last_name']"),email:this.$("input[name='email']"),mobile_number:this.$("input[name='mobile_number']"),title:this.$("input[name='title']"),description:this.$("textarea[name='description']"),rating:{}},this.model.menu.models.forEach(function(t){e.addItemCategory(t)}),this.model.menu.on("add",this.addItemCategory,this),this.model.reviews.models.forEach(function(t){e.addReview(t)}),this.model.reviews.on("add",this.addReview,this);var t=$(document),i=this.$(".customTabs"),s=this.$(".contentbdox"),r="hoveradds";classNames="extraspace",t.scroll(function(){i.toggleClass(r,t.scrollTop()>=300),s.toggleClass(classNames,t.scrollTop()>=300)})}})});